<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.jfeat.cms.ticket.services.domain.dao.QueryTicketPlanDao">
    <sql id="Base_Column_List">
            tk_ticket_plan.*
        </sql>
        <select id="findTicketPlanPage" resultType="TicketPlan" parameterType="TicketPlan">
            SELECT tk_ticket_plan.*
            FROM tk_ticket_plan
            WHERE 1=1
                             <if test="id != null and id>0 ">
                 AND tk_ticket_plan.id LIKE CONCAT('%',#{id},'%')
            </if>
                                             <if test="applicantId != null and applicantId>0 ">
                 AND tk_ticket_plan.applicant_id LIKE CONCAT('%',#{applicantId},'%')
            </if>
                             <if test="applicant != null and applicant!= ''">
                 AND tk_ticket_plan.applicant LIKE CONCAT('%',#{applicant},'%')
            </if>
                             <if test="number != null and number!= ''">
                 AND tk_ticket_plan.number LIKE CONCAT('%',#{number},'%')
            </if>
                                             <if test="applyTime != null and applyTime>0 ">
                 AND tk_ticket_plan.apply_time LIKE CONCAT('%',#{applyTime},'%')
            </if>
                             <if test="status != null and status!= ''">
                 AND tk_ticket_plan.status LIKE CONCAT('%',#{status},'%')
            </if>
                                             <if test="executorId != null and executorId>0 ">
                 AND tk_ticket_plan.executor_id LIKE CONCAT('%',#{executorId},'%')
            </if>
                             <if test="executor != null and executor!= ''">
                 AND tk_ticket_plan.executor LIKE CONCAT('%',#{executor},'%')
            </if>
                                             <if test="planStartTime != null and planStartTime>0 ">
                 AND tk_ticket_plan.plan_start_time LIKE CONCAT('%',#{planStartTime},'%')
            </if>
                                             <if test="executeEndTime != null and executeEndTime>0 ">
                 AND tk_ticket_plan.plan_end_time LIKE CONCAT('%',#{planEndTime},'%')
            </if>
                                             <if test="process_instanceId != null and process_instanceId>0 ">
                 AND tk_ticket_plan.process_instance_id LIKE CONCAT('%',#{processInstanceId},'%')
            </if>
                                             <if test="strategyId != null and strategyId>0 ">
                 AND tk_ticket_plan.strategy_id LIKE CONCAT('%',#{strategyId},'%')
            </if>
                                             <if test="strategyName != null and strategyName!= ''">
                 AND tk_ticket_plan.strategy_name LIKE CONCAT('%',#{strategyName},'%')
            </if>
                             <if test="lifecycle != null and lifecycle!= ''">
                 AND tk_ticket_plan.lifecycle LIKE CONCAT('%',#{lifecycle},'%')
            </if>
                             <if test="name != null and name!= ''">
                 AND tk_ticket_plan.name LIKE CONCAT('%',#{name},'%')
            </if>
                                             <if test="plan_departmentId != null and plan_departmentId>0 ">
                 AND tk_ticket_plan.plan_department_id LIKE CONCAT('%',#{planDepartmentId},'%')
            </if>
                                             <if test="plan_departmentName != null and plan_departmentName!= ''">
                 AND tk_ticket_plan.plan_department_name LIKE CONCAT('%',#{planDepartmentName},'%')
            </if>
                                             <if test="execute_departmentId != null and execute_departmentId>0 ">
                 AND tk_ticket_plan.execute_department_id LIKE CONCAT('%',#{executeDepartmentId},'%')
            </if>
                                             <if test="execute_departmentName != null and execute_departmentName!= ''">
                 AND tk_ticket_plan.execute_department_name LIKE CONCAT('%',#{executeDepartmentName},'%')
            </if>
                                             <if test="fault_ticketId != null and fault_ticketId>0 ">
                 AND tk_ticket_plan.fault_ticket_id LIKE CONCAT('%',#{faultTicketId},'%')
            </if>
                                             <if test="faultName != null and faultName!= ''">
                 AND tk_ticket_plan.fault_name LIKE CONCAT('%',#{faultName},'%')
            </if>
                                             <if test="typeId != null and typeId>0 ">
                 AND tk_ticket_plan.type_id LIKE CONCAT('%',#{typeId},'%')
            </if>
                                             <if test="typeName != null and typeName!= ''">
                 AND tk_ticket_plan.type_name LIKE CONCAT('%',#{typeName},'%')
            </if>
                             <if test="practices != null and practices!= ''">
                 AND tk_ticket_plan.practices LIKE CONCAT('%',#{practices},'%')
            </if>
                                             <if test="practicesStep != null and practicesStep!= ''">
                 AND tk_ticket_plan.practices_step LIKE CONCAT('%',#{practicesStep},'%')
            </if>
                             <if test="content != null and content!= ''">
                 AND tk_ticket_plan.content LIKE CONCAT('%',#{content},'%')
            </if>
                    </select>

    <select id="queryMasterList" resultType="TicketPlan">
        SELECT *
        FROM tk_ticket_plan
        WHERE 1=1
        <if test="applicantOrExecutorId != null and applicantOrExecutorId != ''">
            AND ((tk_ticket_plan.applicant_id = #{applicantOrExecutorId})
            OR (tk_ticket_plan.status is not null and tk_ticket_plan.status != 'DRAFT' AND tk_ticket_plan.executor_id = #{applicantOrExecutorId}))
        </if>
        <if test="applicant != null and applicant != ''">
            AND tk_ticket_plan.applicant LIKE CONCAT ('%',#{applicant},'%')
        </if>
        <if test="number != null and number != ''">
            AND tk_ticket_plan.number LIKE CONCAT ('%',#{number},'%')
        </if>
        <if test="name != null and name != ''">
            AND tk_ticket_plan.name LIKE CONCAT ('%',#{name},'%')
        </if>
        <if test="executor != null and executor != ''">
            AND tk_ticket_plan.executor LIKE CONCAT ('%',#{executor},'%')
        </if>
        <if test="planDepartmentName != null and planDepartmentName != ''">
            AND tk_ticket_plan.plan_department_name LIKE CONCAT ('%',#{planDepartmentName},'%')
        </if>
        <if test="executeDepartmentName != null and executeDepartmentName != ''">
            AND tk_ticket_plan.execute_department_name LIKE CONCAT ('%',#{executeDepartmentName},'%')
        </if>
        <if test="startTime != null and startTime != '' and endTime != null and endTime != ''">
            AND (tk_ticket_plan.apply_time BETWEEN #{startTime} AND #{endTime})
        </if>
        <if test="status != null and status != ''">
            AND tk_ticket_plan.status = #{status}
        </if>
        order by apply_time DESC
    </select>

    <select id="queryList" resultType="TicketPlan" parameterType="TicketPlan">
        SELECT tk_ticket_plan.*
        FROM tk_ticket_plan
        WHERE 1=1
        <if test="status != null and status != ''">
            AND tk_ticket_plan.status = #{status}
        </if>
    </select>


    <select id="planWarnings" resultType="TicketPlan">
        SELECT * from tk_ticket_plan WHERE
        tk_ticket_plan.`status`='VERIFIED'
        AND DATE_SUB(CURDATE(), INTERVAL 7 DAY) &lt; date(tk_ticket_plan.apply_time)
    </select>

    <delete id="deleteWfInstance" >
        delete from wf_process_instance where form_id = #{id} and form_type = #{type}
    </delete>
</mapper>