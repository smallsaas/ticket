<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.jfeat.cms.ticket.services.domain.dao.QueryTicketAcceptanceDao">
    <sql id="Base_Column_List">
        tk_ticket_acceptance.*
    </sql>
    <select id="findTicketAcceptancePage" resultType="TicketAcceptance" parameterType="TicketAcceptance">
        SELECT tk_ticket_acceptance.*
        FROM tk_ticket_acceptance
        WHERE 1=1
        <if test="id != null and id>0 ">
            AND tk_ticket_acceptance.id = #{id}
        </if>
        <if test="applicantId != null and applicantId>0 ">
            AND tk_ticket_acceptance.applicant_id = #{applicantId}
        </if>
        <if test="applicant != null and applicant!= ''">
            AND tk_ticket_acceptance.applicant LIKE CONCAT('%',#{applicant},'%')
        </if>
        <if test="number != null and number!= ''">
            AND tk_ticket_acceptance.number LIKE CONCAT('%',#{number},'%')
        </if>
        <if test="applyTime != null and applyTime>0 ">
            AND tk_ticket_acceptance.apply_time = #{applyTime}
        </if>
        <if test="status != null and status!= ''">
            AND tk_ticket_acceptance.status LIKE CONCAT('%',#{status},'%')
        </if>
        <if test="executorId != null and executorId>0 ">
            AND tk_ticket_acceptance.executor_id = #{executorId}
        </if>
        <if test="executor != null and executor!= ''">
            AND tk_ticket_acceptance.executor LIKE CONCAT('%',#{executor},'%')
        </if>
        <if test="executeTime != null and executeTime>0 ">
            AND tk_ticket_acceptance.execute_time LIKE CONCAT('%',#{executeTime},'%')
        </if>
        <if test="processInstanceId != null and processInstanceId>0 ">
            AND tk_ticket_acceptance.process_instance_id = #{processInstanceId}
        </if>
        <if test="strategyId != null and strategyId>0 ">
            AND tk_ticket_acceptance.strategy_id = #{strategyId}
        </if>
        <if test="strategyName != null and strategyName!= ''">
            AND tk_ticket_acceptance.strategy_name LIKE CONCAT('%',#{strategyName},'%')
        </if>
        <if test="lifecycle != null and lifecycle!= ''">
            AND tk_ticket_acceptance.lifecycle LIKE CONCAT('%',#{lifecycle},'%')
        </if>
        <if test="name != null and name!= ''">
            AND tk_ticket_acceptance.name LIKE CONCAT('%',#{name},'%')
        </if>
        <if test="planDepartmentId != null and planDepartmentId>0 ">
            AND tk_ticket_acceptance.plan_department_id = #{planDepartmentId}
        </if>
        <if test="planDepartmentName != null and planDepartmentName != ''">
            AND tk_ticket_acceptance.plan_department_name LIKE CONCAT('%',#{planDepartmentName},'%')
        </if>
        <if test="executeDepartmentId != null and executeDepartmentId>0 ">
            AND tk_ticket_acceptance.execute_department_id = #{executeDepartmentId}
        </if>
        <if test="executeDepartmentName != null and executeDepartmentName != ''">
            AND tk_ticket_acceptance.execute_department_name LIKE CONCAT('%',#{executeDepartmentName},'%')
        </if>
        <if test="faultTicketId != null and faultTicketId>0 ">
            AND tk_ticket_acceptance.fault_ticket_id = #{faultTicketId}
        </if>
        <if test="faultName != null and faultName!= ''">
            AND tk_ticket_acceptance.fault_name LIKE CONCAT('%',#{faultName},'%')
        </if>
        <if test="typeId != null and typeId>0 ">
            AND tk_ticket_acceptance.type_id = #{typeId}
        </if>
        <if test="typeName != null and typeName!= ''">
            AND tk_ticket_acceptance.type_name LIKE CONCAT('%',#{typeName},'%')
        </if>
        <if test="practices != null and practices!= ''">
            AND tk_ticket_acceptance.practices LIKE CONCAT('%',#{practices},'%')
        </if>
        <if test="practicesStep != null and practicesStep!= ''">
            AND tk_ticket_acceptance.practices_step LIKE CONCAT('%',#{practicesStep},'%')
        </if>
        <if test="content != null and content!= ''">
            AND tk_ticket_acceptance.content LIKE CONCAT('%',#{content},'%')
        </if>
        <if test="ticketId != null and ticketId>0 ">
            AND tk_ticket_acceptance.ticket_id = #{ticketId}
        </if>
        <if test="inspectorId != null and inspectorId>0 ">
            AND tk_ticket_acceptance.inspector_id = #{inspectorId}
        </if>
        <if test="inspectorName != null and inspectorName!= ''">
            AND tk_ticket_acceptance.inspector_name LIKE CONCAT('%',#{inspectorName},'%')
        </if>
        <if test="checkDepartmentId != null and checkDepartmentId>0 ">
            AND tk_ticket_acceptance.check_department_id = #{checkDepartmentId}
        </if>
        <if test="checkDepartmentName != null and checkDepartmentName!= ''">
            AND tk_ticket_acceptance.check_department_name LIKE CONCAT('%',#{checkDepartmentName},'%')
        </if>
        <if test="checkTime != null and checkTime>0 ">
            AND tk_ticket_acceptance.check_time LIKE CONCAT('%',#{checkTime},'%')
        </if>
        <if test="result != null and result!= ''">
            AND tk_ticket_acceptance.result LIKE CONCAT('%',#{result},'%')
        </if>
        <if test="note != null and note!= ''">
            AND tk_ticket_acceptance.note LIKE CONCAT('%',#{note},'%')
        </if>
        order by apply_time DESC,execute_time DESC,check_time DESC
    </select>

    <select id="queryMasterList" resultType="TicketAcceptance">
        SELECT *
        FROM tk_ticket_acceptance
        WHERE 1=1
        <if test="applicantOrExecutorId != null and applicantOrExecutorId != ''">
            AND ((tk_ticket_acceptance.applicant_id = #{applicantOrExecutorId})
            OR (tk_ticket_acceptance.status is not null and tk_ticket_acceptance.status != 'DRAFT' AND
            tk_ticket_acceptance.executor_id = #{applicantOrExecutorId}))
        </if>
        <if test="applicant != null and applicant != ''">
            AND tk_ticket_acceptance.applicant LIKE CONCAT ('%',#{applicant},'%')
        </if>
        <if test="number != null and number != ''">
            AND tk_ticket_acceptance.number LIKE CONCAT ('%',#{number},'%')
        </if>
        <if test="name != null and name != ''">
            AND tk_ticket_acceptance.name LIKE CONCAT ('%',#{name},'%')
        </if>
        <if test="executor != null and executor != ''">
            AND tk_ticket_acceptance.executor LIKE CONCAT ('%',#{executor},'%')
        </if>
        <if test="planDepartmentName != null and planDepartmentName != ''">
            AND tk_ticket_acceptance.plan_department_name LIKE CONCAT ('%',#{planDepartmentName},'%')
        </if>
        <if test="executeDepartmentName != null and executeDepartmentName != ''">
            AND tk_ticket_acceptance.execute_department_name LIKE CONCAT ('%',#{executeDepartmentName},'%')
        </if>
        <if test="startTime != null and startTime != '' and endTime != null and endTime != ''">
            AND (tk_ticket_acceptance.apply_time BETWEEN #{startTime} AND #{endTime})
        </if>
        <if test="status != null and status != ''">
            AND tk_ticket_acceptance.status = #{status}
        </if>
        ORDER BY apply_time DESC
    </select>
</mapper>